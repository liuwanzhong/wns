<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
	<link href="/images/index.css" type="text/css" rel="stylesheet"/>
	<link rel="stylesheet" href="/images/css.css">
	<link rel="stylesheet" href="/images/boot.css">
	<link rel="stylesheet" type="text/css" href="/layui/css/layui.css"/>
	<link rel="stylesheet" type="text/css" href="/images/style.css"/>
</head>
<body>
		<div class="note">
			<h4>添加管理员</h4>
				<table class="news_form">
					<tr>
						<td>所属部门：</td>
						<td><select name="department_id" id="department_id">
							<option value="0">---请选择所属部门---</option>
							{volist name='rows' id='row'}
							<option value="{$row['id']}">{$row['name']}</option>
							{/volist}
						</select></td>
					</tr>
					<tr>
						<td>员工编号：</td>
						<td><input type="text" id="staffs_number" name="staffs_number" class="inbox"/><span style="color:red">(编号必须唯一)</span></td>
					</tr>
					<tr>
						<td>员工姓名:</td>
						<td><input type="text" id="staffs_name" name="staffs_name" class="inbox"/></td>
					</tr>
					<tr>
						<td>登录密码:</td>
						<td><input type="password" id="password" name="password" class="inbox"/><span style="color:red">(不填则默认为123456)</span></td>
					</tr>
					<tr>
						<td>联系电话:</td>
						<td><input type="text" id="tel" name="tel" class="inbox"/></td>
					</tr>
					<tr>
						<td>QQ:</td>
						<td><input type="text" id="qq" name="qq" class="inbox"/></td>
					</tr>
					<tr>
						<td>Email:</td>
						<td><input type="text" id="email" name="email" class="inbox"/></td>
					</tr>
					<tr>
						<td>员工权限:</td>
						<td>
							<div class="d" id="a">
								{volist name='md' id='m'}
								<div class="box">
									<div class="title">
										<label for="{$m['id']}">
											<input type="checkbox" name="" id="{$m['id']}" value="{$m['id']}"/>
											<i></i>
											{$m['pow_name']}
										</label>
									</div>
									<ul class="lists">
										{volist name='m.child' id='m2'}
										<li class="items">
											<div class="tit">
												<label for="{$m2['id']}">
													<input type="checkbox" name="" id="{$m2['id']}" value="{$m2['id']}"/>
													<i></i>
													{$m2['pow_name']}
												</label>
											</div>
											<ul class="children">
												{volist name='m2.child' id='m3'}
												<li>
													<label for="{$m3['id']}">
														<input type="checkbox" name="" id="{$m3['id']}" value="{$m3['id']}" />
														<i></i>
														{$m3['pow_name']}
													</label>
												</li>
												{/volist}
											</ul>
										</li>
										{/volist}
									</ul>
								</div>
								{/volist}
								<button id="btn">提交</button>
							</div>
						</td>
					</tr>
				</table>
		</div>
		<script src="/static/js/jquery-1.9.1.min.js"></script>
		<script src="/static/js/check.js" type="text/javascript"></script>
		<script src="/static/layer/layer.js" type="text/javascript" charset="utf-8"></script>

		<script>
			let check_all=[];

			// 点击提交
			$('#btn').click(function () {
				var s=$("input:checkbox:checked");
				for (let i in s) {
					if(s[i].checked){
						check_all.push(s[i].value);
					}
				}
				let staffs_number=$('#staffs_number').val();
				let staffs_name=$('#staffs_name').val();
				let password=$('#password').val();
				let tel=$('#tel').val();
				let qq=$('#qq').val();
				let email=$('#email').val();
				let department_id=$('#department_id').val();
				$.ajax({
					url:"/index/Staffs/staffs_insert",
					type:"post",
					data:{"obj":check_all,"staffs_number":staffs_number,"staffs_name":staffs_name,"password":password,"tel":tel,"qq":qq,"email":email,"department_id":department_id},
					success:function (data) {
						console.log(data)
						if(data.error==1){
							layer.alert(data.ts, {
								icon: 6,
								yes:function(){
									location.href='/index/Staffs/staffs';
								}
							});
						}else{
							layer.alert(data.ts, {
								icon: 6
							});
						}
					},
					error:function(error){
						console.log('错误提示:' + error)
					}
				})
			})
			// 判断哪些权限被选中
			$(function(){
				let list = $("input:checkbox");
				for (let i = 0; i<list.length; i++) {
					if(list[i].checked){
						$(list[i]).parent().addClass('selted');
					}
				}
			})
		</script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<style>
			.d{background: #fff;margin:20px;padding:20px}
		</style>
</body>
</html>
