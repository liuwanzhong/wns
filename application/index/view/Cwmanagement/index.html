<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>后台管理系统</title>
		<link href="/images/index.css" type="text/css" rel="stylesheet"/>
		<script src="/images/jquery.js"></script>
		<link rel="stylesheet" href="/images/css.css">
        <link rel="stylesheet" href="/images/boot.css">	</head>
        <link rel="stylesheet" type="text/css" href="/layui/css/layui.css" />
	</head>
	<body>

		<div class="note">
                <h4><a href="#" style="background:#75bdb6;padding:5px;border:none;color:#fff" id="dialog">导入excel表</a><a href="{:url('Cwmanagement/clink')}" style="float: right;background:#75bdb6;padding:5px;border:none;color:#fff" id="clink">清除数据</a></h4>
                <div>
                    <div>
                        <form action="{:url('Cwmanagement/index')}" method="post" enctype="multipart/form-data">
                        <div class="wrap">
                            <label>搜索条件</label>
                            <label>调拨订单号</label>
                            <input type="text" id="transfers_i" name="transfers_id" value="<?php if(!empty($data['transfers_id'])){echo $data['transfers_id'];}?>" />
                            <label>时间</label>
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input" id="delivery_time" name="delivery_time" placeholder=" - " value="<?php if(!empty($data['delivery_time'])){echo $data['delivery_time'];}?>">
                            </div>
                            <label>物料名</label>
                            <input type="text" id="material_name" name="material_name" value="" value="<?php if(!empty($data['material_name'])){echo $data['material_name'];}?>"/>
                            <input type="submit" class="save" id="btn" value="查询"/>
                        </div>
                        </form>
                    </div>
                    <input type="submit" value="删除" id="del"/>
                    <input type="button" value="生成入库单" id="rukuorder"/>
                </div>

			<table class="news_list">
				<thead>
					<tr>
                        <th><input type="checkbox" id="all"></th>
						<th>调拨订单编号</th>
						<th>物料名</th>
						<th>调拨出库工厂</th>
						<th>生产日期</th>
						<th>调出数量</th>
						<th>调拨入库日期</th>
						<th>调拨入库数量</th>
                        <th>净重</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
                {if condition="!empty($list)"}
				{volist name='list' id='r'}
					<tr id="check">
                        <input type="hidden" name="id" value="{$r.id}">
                        <td><input type="checkbox" value="{$r.id}"></td>
						<td>{$r.transfers_id}</td>
						<td>{$r.material_name}</td>
						<td>{$r.transfers_factory}</td>
						<td><?php if($r['production_time']!=0){echo date("Y/m/d",$r['production_time']);}?></td>
						<td>{$r.Bring_up_num}</td>
						<td><?php if($r['transfers_into_time']!=0){echo date("Y/m/d",$r['transfers_into_time']);}?></td>
						<td>{$r.transfers_into_num}</td>
                        <td>{$r.Bring_up_net_weight}</td>
						<td>
                            <a href="#" class="btn btn-info img_edit">详细</a>
                            <a href="{:url('Cwmanagement/check_record_del','id='.$r.id)}" class="btn btn-danger">删除</a>

                        </td>
					</tr>
                {/volist}
                {/if}
				</tbody>
			</table>
            <div style="text-align:center">
            {if condition="!empty($list)"}
            {$list->render()}
            {/if}
            </div>

        </div>
        <!-- 导入 -->
        <div class="model">
                <div class="head">
                    <span>导入excel表</span>
                    <a href="javascript:" class="close">×</a>
                </div>
                <div class="content">
                    <form action="{:url('Cwmanagement/upload_excel')}" method="post" enctype="multipart/form-data">
                        <div class="wrap">
                            <input type="file" name="file" value="" required oninvalid="setCustomValidity('
                                不能为空') oninput="setCustomValidity('')"/>
                            <input type="submit" class="save" id="btn" value="确定"/>
                        </div>
                    </form>
                </div>
            </div>
        <!-- 详细 -->
        <div class="model_edit">
                <div class="head">
                    <span>修改商品</span>
                    <a href="javascript:" class="close_edit">×</a>
                </div>
                <div class="content" style="height:550px;width:800px;overflow:auto;">
                    <form action="{:url('Cwmanagement/record_update')}" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="id" id="id">
                        <div class="wrap">
                            <label>调拨订单号</label>
                            <input type="text" id="transfers_id" name="transfers_id" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>交付单号</label>
                            <input type="text" id="delivery_id" name="delivery_id" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>交货单实际出库日期</label>
                            <input type="text" id="delivery_time" name="delivery_time" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')" placeholder="xxxx/x/x"/>
                        </div>
                        <div class="wrap">
                            <label>调拨出库工厂</label>
                            <input type="text" id="transfers_factory" name="transfers_factory" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>物料名称</label>
                            <input type="text" id="material_name" name="material_name" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>生产日期</label>
                            <input type="text" id="production_time" name="production_time" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')" placeholder="xxxx/x/x"/>
                        </div>
                        <div class="wrap">
                            <label>装运类型</label>
                            <input type="text" id="transport_type" name="transport_type" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>集装箱号/车皮号</label>
                            <input type="text" id="container_id" name="container_id" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>在途净重</label>
                            <input type="text" id="zt_net_weight" name="zt_net_weight" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>在途毛重</label>
                            <input type="text" id="zt_Gross_weight" name="zt_Gross_weight" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>在途数量</label>
                            <input type="text" id="zt_num" name="zt_num" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>调出数量</label>
                            <input type="text" id="Bring_up_num" name="Bring_up_num" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>调拨入库时间</label>
                            <input type="text" id="transfers_into_time" name="transfers_into_time" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')" placeholder="xxxx/x/x"/>
                        </div>
                        <div class="wrap">
                            <label>调拨入库地点</label>
                            <input type="text" id="transfers_into_addres" name="transfers_into_addres" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>调拨出库地点</label>
                            <input type="text" id="transfers_out" name="transfers_out" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>调出毛重</label>
                            <input type="text" id="Bring_up_Gross_weight" name="Bring_up_Gross_weight" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>调出净重</label>
                            <input type="text" id="Bring_up_net_weight" name="Bring_up_net_weight" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>调拨入库数量</label>
                            <input type="text" id="transfers_into_num" name="transfers_into_num" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>调拨入库毛重</label>
                            <input type="text" id="transfers_into_Gross_weight" name="transfers_into_Gross_weight" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>调拨入库净重</label>
                            <input type="text" id="transfers_into_net_weight" name="transfers_into_net_weight" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>
                        <div class="wrap">
                            <label>备注</label>
                            <input type="text" id="note" name="note" value="" required oninvalid="setCustomValidity('
                            不能为空') oninput="setCustomValidity('')"/>
                        </div>

                        <div class="wrap btn">
                            <input type="submit" class="save" id="btn" value="修改"/>
                        </div>
                    </form>
                </div>
            </div>
        <script src="/static/jquery-1.9.1.min.js"></script>
        <script src="/static/layer/layer.js" type="text/javascript" charset="utf-8"></script>
        <script src="/layui/layui.js"></script>
        <script type="text/javascript">
            //导入excel表
			$('#dialog').on('click', function(){
				$('.model').show();
			})
			$('.close').on('click', function(){
				$('.model').hide();
			})
            //详细
			$('.img_edit').on('click', function(){
				$('.model_edit').show();
			})
            $('.close_edit').on('click', function(){
				$('.model_edit').hide();
			})
            //详细回显
			$('.img_edit').click(function(){
				let val = $(this).parents('tr').find('input[type=hidden]').val();
				$.ajax({
					url:'/index/Cwmanagement/record_edit',
					type:'post',
					data:{'id':val},
					success:function(data){
					    console.log(data)
                        $('#id').val(data.id)
						$('#transfers_id').val(data.transfers_id)
						$('#delivery_id').val(data.delivery_id)
						$('#delivery_time').val(data.delivery_time)
						$('#transfers_factory').val(data.transfers_factory)
						$('#material_name').val(data.material_name)
						$('#production_time').val(data.production_time)
						$('#transport_type').val(data.transport_type)
						$('#container_id').val(data.container_id)
						$('#zt_net_weight').val(data.zt_net_weight)
						$('#zt_Gross_weight').val(data.zt_Gross_weight)
						$('#zt_num').val(data.zt_num)
						$('#Bring_up_num').val(data.Bring_up_num)
						$('#transfers_into_time').val(data.transfers_into_time)
						$('#transfers_into_addres').val(data.transfers_into_addres)
						$('#transfers_out').val(data.transfers_out)
						$('#Bring_up_Gross_weight').val(data.Bring_up_Gross_weight)
						$('#Bring_up_net_weight').val(data.Bring_up_net_weight)
						$('#transfers_into_factory').val(data.transfers_into_factory)
						$('#transfers_into_num').val(data.transfers_into_num)
						$('#transfers_into_Gross_weight').val(data.transfers_into_Gross_weight)
						$('#transfers_into_net_weight').val(data.transfers_into_net_weight)
					}
				})
            })

            //全选或全不选
            $("#all").click(function(){
                if(this.checked){
                $("#check :checkbox,#all").prop("checked", true);
                }else{
                $("#check :checkbox,#all").prop("checked", false);
                }
            });
            let check_all=[];
                // 删除选中
                $('#del').click(function(){
                    var s=$("input:checkbox:checked");
                    for (let i in s) {
                        if(s[i].checked){
                            check_all.push(s[i].value);
                        }
                    }
                    console.log(check_all);
                    $.ajax({
                        url:'/index/Cwmanagement/check_record_del',
                        type:'post',
                        data:{'check_all':check_all},
                        success:function (data) {
                            if(data.error==1){
                                layer.alert(data.ts, {
                                    icon: 6,
                                    yes:function(){
                                        location.href='/index/Cwmanagement/index';
                                    }
                                });
                            }else{
                                layer.alert(data.ts, {
                                    icon: 6,
                                    yes:function(){
                                        location.href='/index/Cwmanagement/index';
                                    }
                                });
                            }
                            console.log(data);
                        },
                        error:function(error){
                            console.log('错误提示:' + error)
                        }
                    })
                })
        </script>

        <!-- 时间选择 -->
        <script>
            layui.use('laydate', function(){
                var laydate = layui.laydate;
                laydate.render({
                    elem: '#delivery_time'
                    ,range: '~'
                    ,done: function(value){
                        $('#delivery_time').val(value)
                    }
                });
            })
                    $.ajax({
                        url:'/index/Cwmanagement/check_out_excel',
                        type:'post',
                        data:{'check_all':check_all},
                        success:function (data) {
                            if(data.error!=1){
                                alert('导出成功');
                            }
                        },
                        error:function(error){
                            console.log('错误提示:' + error)
                        }
                    })

            let session=[];
            $('.news_list').on('click','input[type=checkbox]',function () {
                let ses=JSON.parse(sessionStorage.getItem('session'));
                session = ses === null ? [] : ses;

                if($(this)[0].checked == true){
                    session.push($(this).val());
                }else{
                    let val = $(this).val();
                    for (let i in session){
                        if(session[i] == val){
                            session.splice(i,1);
                        }
                    }
                }
                sessionStorage.setItem('session',JSON.stringify(session));
            })

            $(function () {
                let list = JSON.parse(sessionStorage.getItem('session'));
                $('.news_list input[type=checkbox]').each(function () {
                    if(list.includes($(this).val()) ){
                        $(this).prop('checked',true);
                    }
                })
            })
        $('#bt').click(function () {

        })

        $("#rukuorder").on("click",function(){
            var orders = sessionStorage.getItem('session');
            location.href = "/index/Rukuorder/index/id/"+orders;
        })
        </script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	</body>
</html>
